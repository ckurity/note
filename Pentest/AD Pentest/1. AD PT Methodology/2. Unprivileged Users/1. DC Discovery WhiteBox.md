- [Find Domain Name](#find-domain-name-1)
    - [CMD](#cmd)
        - [set u](#set-u)
        - [echo](#echo)
    - [PowerShell](#powershell)
        - [env](#env)
        - [Get-ADDomain](#get-addomain)
        - [System.DirectoryServices.ActiveDirectory.Domain](#systemdirectoryservicesactivedirectorydomain)
    - [Windows](#windows)
        - [systeminfo](#systeminfo)
        - [ipconfig](#ipconfig)
    - [GUI](#gui)
- [Identifying All Domain Names]
- [Find Domain Controllers (DC)](#find-domain-controllers-dc)
    - [LOGONSERVER]
    - [nslookup](#nslookup)
    - [nltest]
    - [Get-ADDomainController]
- [References](#references)

-------------------------------------------

## [Find Domain Name](#find-domain-name-1)

Remember that only computers joined to AD will have a domain name. These methods won't work on standalone machines.

### [CMD](#cmd-1)
Not case sensitive
```sh   Syntax
set u
set USERDNSDOMAIN
set USERDOMAIN
echo %userdomain%
```

#### [set u](#set-u-1)
```sh   Example
lunar\thm@LUNDC C:\Users\thm>set USERDOMAIN
USERDOMAIN=LUNAR

lunar\thm@LUNDC C:\Users\thm>set u
USER=lunar\thm           
USERDOMAIN=LUNAR         
USERNAME=thm             
USERPROFILE=C:\Users\thm
```

#### [echo](#echo-1)
```sh   Example
lunar\thm@LUNDC C:\Users\thm>echo %USERDOMAIN%
LUNAR
```

### [PowerShell](#powershell-1)
choose any
```sh   Syntax
echo $env:USERDOMAIN
$env:USERDOMAIN
ls env:USERDOMAIN
ls env:u*

(Get-ADDomain).name
(Get-ADDomain).distinguishedname
(Get-ADDomain).DNSRoot
Get-ADDomain

[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().Name

(Get-WmiObject Win32_ComputerSystem).Domain
```

```sh
PS C:\Users\thm> (Get-ADDomain).DNSRoot
lunar.eruca.com

PS C:\Users\thm> [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().Name
lunar.eruca.com
```

#### [env](#env-1)
```sh   Example
PS C:\Users\thm> echo $env:USERDOMAIN
LUNAR

PS C:\Users\thm> ls env:USERDOMAIN

Name                           Value
----                           -----
USERDOMAIN                     LUNAR

PS C:\Users\thm> ls env:u*

Name                           Value
----                           -----
USERPROFILE                    C:\Users\thm
USERNAME                       thm
USER                           lunar\thm
USERDOMAIN                     LUNAR
```

#### [Get-ADDomain](#get-addomain)
```sh   Example     (Get-ADDomain).DNSRoot
PS C:\Users\thm> (Get-ADDomain).DNSRoot
lunar.eruca.com
```
```sh   Example     Get-ADDomain | Select-Object Name   
PS C:\Users\thm> Get-ADDomain | Select-Object Name

Name  
----
lunar

PS C:\Users\thm> (Get-ADDomain).Name
lunar
```

#### [System.DirectoryServices.ActiveDirectory.Domain](#systemdirectoryservicesactivedirectorydomain-1)
```sh   Example
PS C:\Users\thm> [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().Name
lunar.eruca.com

PS C:\Users\thm> [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()

Forest                  : lunar.eruca.com
DomainControllers       : {LUNDC.lunar.eruca.com}
Children                : {}
DomainMode              : Windows2012R2Domain
DomainModeLevel         : 6
Parent                  :
PdcRoleOwner            : LUNDC.lunar.eruca.com
RidRoleOwner            : LUNDC.lunar.eruca.com
InfrastructureRoleOwner : LUNDC.lunar.eruca.com
Name                    : lunar.eruca.com
```

### [Windows](#windows-1)
```sh   Example
systeminfo | findstr Domain
ipconfig /all | findstr /i "Connection-specific DNS Suffix"
```

#### [systeminfo](#systeminfo-1)

#### [ipconfig](#ipconfig-1)
```sh   Example
PS C:\Users\thm> ipconfig /all | findstr /i "Connection-specific DNS Suffix"
Primary Dns Suffix  . . . . . . . : lunar.eruca.com
   DNS Suffix Search List. . . . . . : eu-west-1.ec2-utilities.amazonaws.com
   Connection-specific DNS Suffix  . : eu-west-1.compute.internal
   DNS Servers . . . . . . . . . . . : 10.0.0.2
```

### [GUI](#gui-1)
```sh
1. Open System Properties: Press Windows + R to open the Run dialog box. Type sysdm.cpl and press Enter.
2. Navigate to Computer Name tab: In the System Properties window, select the Computer Name tab.
3. Check Member of domain: Under the Member of section, you will see the domain name if the computer is joined to a domain.
```

## [Identifying All Domain Names]
```sh
Get-ADForest
Get-ADForest | Select-Object -ExpandProperty Domains
```

```sh
PS C:\Users\thm> Get-ADForest | Select-Object -ExpandProperty Domains
lunar.eruca.com
```

[Find Domain Controllers (DC)](#find-domain-controllers-dc-1)
If you have a domain joined Windows Machine

### [LOGONSERVER]
```sh
C:\>set l
LOCALAPPDATA=C:\Users\pparker\AppData\Local
LOGONSERVER=\\HYDRA-DC

C:\>echo %LOGONSERVER%
\\HYDRA-DC
```

```sh
PS C:\> ls env:l*

Name                           Value
----                           -----
LOCALAPPDATA                   C:\Users\pparker\AppData\Local
LOGONSERVER                    \\HYDRA-DC

PS C:\> $env:LOGONSERVER
\\HYDRA-DC

PS C:\> ping HYDRA-DC -n 1

Pinging HYDRA-DC.MARVEL.local [10.0.2.250] with 32 bytes of data:
Reply from 10.0.2.250: bytes=32 time<1ms TTL=128
```

### [nslookup](#nslookup-1)
```sh
#Finding DC IP
nslookup -querytype=SRV _LDAP._TCP.DC._MSDCS.<domain_name>
nslookup -querytype=SRV _ldap._tcp.dc._msdcs.EXAMPLE.COM

# http://dev.blog.theredteamguy.com/pentesting/internal-pentest-cheat-sheet/#list-domain-controllers-nslookup
nslookup -type=SRV _ldap._tcp.DOMAIN_NAME
nslookup -> set type=all -> _ldap._tcp.dmsdcs.DOMAIN_NAME
nslookup -type=srv _ldap._tcp.dc._msdcs.DOMAIN_NAME
```

https://pswalia2u.medium.com/ad-enumeration-b2303ba8671c

Nslookup should give you a list of all domaincontrollers of `frontoso.com`
https://secattic.blogspot.com/2013/



### [nltest]
```sh
nltest /server:<IP> /dclist:<domain_name>

/DCLIST:<DomainName> - Get list of DC's for <DomainName>
/DCNAME:<DomainName> - Get the PDC name for <DomainName>
```

### [System.DirectoryServices]
```sh
[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().DomainControllers
New-Object System.DirectoryServices.DirectoryEntry
```

### [Get-ADDomainController]
```sh
Get-ADDomainController
Get-ADDomainController -Filter * | Select-Object Name, Domain
Get-ADDomainController -Filter * | Select-Object Name, Domain, Enabled, Forest, IPv4Address, OperatingSystem, Site | Format-Table
Get-ADDomainController -Server "DOMAIN-NAME" -Filter * | Select-Object Name, Domain, Enabled, Forest, IPv4Address, OperatingSystem, Site | Format-Table
```

https://br33z3.github.io/rtfm

## 
```sh

```

## 
```sh

```

## 
```sh

```

```sh
Get-Domain | Select-Object -ExpandProperty DomainControllers
```

## [netdom](#netdom)

# [References](#references-1)

https://adsecurity.org/wp-content/uploads/2016/08/DEFCON24-2016-Metcalf-BeyondTheMCSE-RedTeamingActiveDirectory.pdf

https://pswalia2u.medium.com/ad-enumeration-b2303ba8671c

https://www.slideshare.net/hacknpentest/hunt-for-domain-controller-activedirectory-pentesting-operatingSystemVersion

https://gist.github.com/ahmedjavid

https://www.oreilly.com/library/view/active-directory-cookbook/0596004648/ch03s22.html