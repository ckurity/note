## SMB 101
## smbmap
```
smbmap -H $ip
```

```
$ smbmap -h | g \\-H 
usage: smbmap [-h] (-H HOST | --host-file FILE) [-u USERNAME] [-p PASSWORD]
  -H HOST               IP of host
```
```
$ smbmap -H $ip -r Replication                               
[+] IP: 10.10.10.100:445        Name: active.htb                                        
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        Replication                                             READ ONLY
        .\Replication\*
        dr--r--r--                0 Sat Jul 21 18:37:44 2018    .
        dr--r--r--                0 Sat Jul 21 18:37:44 2018    ..
        dr--r--r--                0 Sat Jul 21 18:37:44 2018    active.htb
```
```
$ smbmap -h | gi \\-r
              [--mode CMDMODE] [-L | -R [PATH] | -r [PATH]] [-A PATTERN | -g]
  
  -R [PATH]             Recursively list dirs, and files (no share\path lists

  -r [PATH]             List contents of directory, default is to list root of
                        all shares, ex. -r 'C$\Documents and
                        a file on a match (requires -R or -r), not case
```

## smbclient

```
smbclient -NL $ip
```

```
$ smbclient --help | eg \\'-N|-L'
  -L, --list=HOST                              Get a list of shares available
  
  -N, --no-pass                                Don't ask for a password
```

```
smbclient -N //$ip/xxx
```
## [Recursively download a directory using smbclient](https://superuser.com/questions/856617/how-do-i-recursively-download-a-directory-using-smbclient)
```
smbclient //server/share
recurse
prompt
mget *
```

```
$ smbclient -N //$ip/Replication
Anonymous login successful
Try "help" to get a list of possible commands.
smb: \> recurse 
smb: \> prompt 
smb: \> mget *
getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\GPT.INI of size 23 as active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/GPT.INI (0.3 KiloBytes/sec) (average 0.3 KiloBytes/sec)
getting file \active.htb\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\GPT.INI of size 22 as active.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/GPT.INI (0.3 KiloBytes/sec) (average 0.3 KiloBytes/sec)
getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\Group Policy\GPE.INI of size 119 as active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/Group Policy/GPE.INI (1.5 KiloBytes/sec) (average 0.7 KiloBytes/sec)
getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Registry.pol of size 2788 as active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Registry.pol (19.3 KiloBytes/sec) (average 8.1 KiloBytes/sec)
getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\Groups.xml of size 533 as active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml (7.7 KiloBytes/sec) (average 8.0 KiloBytes/sec)
getting file \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Microsoft\Windows NT\SecEdit\GptTmpl.inf of size 1098 as active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf (15.8 KiloBytes/sec) (average 9.1 KiloBytes/sec)
getting file \active.htb\Policies\{6AC1786C-016F-11D2-945F-00C04fB984F9}\MACHINE\Microsoft\Windows NT\SecEdit\GptTmpl.inf of size 3722 as active.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf (22.4 KiloBytes/sec) (average 12.4 KiloBytes/sec)
smb: \> 
```

```
$ find active.htb -type f 
active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml
active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf
active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Registry.pol
active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/Group Policy/GPE.INI
active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/GPT.INI
active.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf
active.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/GPT.INI
```

[Nmap NSE SMB](https://www.blackhillsinfosec.com/a-pentesters-voyage-the-first-few-hours/)
| too long, tweak this
```
sudo nmap -sSUV -p U:137,T:139,445 --script 'smb* and not brute' $ip
```

```
enum4linux $ip | tee enum4linux_$(date +%y%m%d-%H%M).txt
```

```

```
```

```