# List shares, via smbclient, crackmapexec, and smbmap

- [smbclient](#smbclient-does-not-show-readwrite-status-use-cme-for-this-purpose)
- [cme](#cme-smb-ip---shares--u---p)
        [-M spider_plus](#m-spider_plus)
- [smbmap](#smbmap--h-ip)
- [$ip must follow sequence as follows, else error (which tool?)](#ip-must-follow-sequence-as-follows-else-error-which-tool)


### smbclient does not show READ/WRITE status, use cme for this purpose
Examples on HTB Active box, 10.10.10.100
```
$ smbclient -NL $ip
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        Replication     Disk      
        SYSVOL          Disk      Logon server share 
        Users           Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.100 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

### cme smb $ip --shares -u '' -p ''
```
$ crackmapexec smb $ip --shares -u '' -p ''
SMB         10.10.10.100    445    DC               [*] Windows 6.1 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\: 
SMB         10.10.10.100    445    DC               [+] Enumerated shares
SMB         10.10.10.100    445    DC               Share           Permissions     Remark
SMB         10.10.10.100    445    DC               -----           -----------     ------
SMB         10.10.10.100    445    DC               ADMIN$                          Remote Admin
SMB         10.10.10.100    445    DC               C$                              Default share
SMB         10.10.10.100    445    DC               IPC$                            Remote IPC
SMB         10.10.10.100    445    DC               NETLOGON                        Logon server share 
SMB         10.10.10.100    445    DC               Replication     READ            
SMB         10.10.10.100    445    DC               SYSVOL                          Logon server share 
SMB         10.10.10.100    445    DC               Users
```

### -M spider_plus
HTB Cascade
```sh
$ cme smb $ip -u r.thompson -p rY4n5eva --shares -M spider_plus
SMB         10.10.10.182    445    CASC-DC1         [*] Windows 6.1 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False)
SMB         10.10.10.182    445    CASC-DC1         [+] cascade.local\r.thompson:rY4n5eva 
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] Started module spidering_plus with the following options:
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]  DOWNLOAD_FLAG: False
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]     STATS_FLAG: True
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] EXCLUDE_FILTER: ['print$', 'ipc$']
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]   EXCLUDE_EXTS: ['ico', 'lnk']
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]  MAX_FILE_SIZE: 50 KB
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]  OUTPUT_FOLDER: /tmp/cme_spider_plus
SPIDER_P... 10.10.10.182    445    CASC-DC1         [+] Saved share-file metadata to "/tmp/cme_spider_plus/10.10.10.182.json".
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] SMB Shares:           8 (ADMIN$, Audit$, C$, Data, IPC$, NETLOGON, print$, SYSVOL)
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] SMB Readable Shares:  4 (Data, NETLOGON, print$, SYSVOL)
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] SMB Filtered Shares:  1
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] Total folders found:  58
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] Total files found:    20
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] File size average:    1.07 KB
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] File size min:        6 B
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] File size max:        5.83 KB
```

### smbmap -H $ip
```
$ smbmap -H $ip
[+] IP: 10.10.10.100:445        Name: active.htb                                        
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    NO ACCESS       Remote IPC
        NETLOGON                                                NO ACCESS       Logon server share 
        Replication                                             READ ONLY
        SYSVOL                                                  NO ACCESS       Logon server share 
        Users                                                   NO ACCESS
```

#### $ip must follow sequence as follows, else error (which tool?)
```
smbmap -H $ip
smbclient -N //$ip/shares -c ls
```