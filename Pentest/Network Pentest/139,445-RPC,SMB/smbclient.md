# smbclient

- [Basic]
  - [Common Flags](#common-flags)
  - [Common Syntax](#common-syntax)
- [Examples](#examples)
  - [List files](#list-files)
    - [List files in one-liner WITHOUT password](#list-files-in-one-liner-without-password)
    - [List files in one-liner WITH password](#list-files-in-one-liner-with-password)
  - [Download directory](#download-directory)
    - [Download a directory recursively](#download-a-directory-recursively)
    - [Download a directory recursively in one-liner without password](#download-a-directory-recursively-in-one-liner-without-password)
- [Drawbacks](#drawbacks)
  - [smbclient](#smbclient-does-not-show-readwrite-status-use-cme-for-this-purpose)
- [Other Tools](#other-tools)
  - [CrackMapExec (cme)](#crackmapexec-cme)
    - [--shares -u '' -p ''](#cme-smb-t---shares--u---p)
    - [-M spider_plus](#m-spider_plus)
  - [smbmap](#smbmap)
    - [smbmap -H $t](#smbmap--h-t)

# [Basic](#basic)
## [Common Flags](#common-flags)
```sh
# smbclient --help | eg \\'-N|-L'
[-N|--no-pass]                              # Don't ask for a password
[-L|--list=HOST]                            # Get a list of shares available
[-U|--user=[DOMAIN/]USERNAME[%PASSWORD]]
[--password=STRING]
[--pw-nt-hash]                              # PtH; Pass the Hash
```

## [Common Syntax](#common-syntax-1)
```sh
smbclient -NL $t
smbclient -N //$t/xx

smbclient -L $t -U svc-alfresco%s3rvice

cme smb $t
cme smb $t --shares -u svc-alfresco -p s3rvice

cme winrm $t
cme winrm $t -u svc-alfresco -p s3rvice

smbclient //$t/SYSVOL -U svc-alfresco%s3rvice -c 'ls'
smbclient //$t/alice -U alice1978 --pw-nt-hash 0B186E661BBDBDCF6047784DE8B9FD8B

sudo mount -t cifs //$t/SYSVOL /mnt -o username=svc-alfresco,password=s3rvice
find /mnt -type f
```

# Examples
## [List files](#list-files-1)
### [List files in one-liner WITHOUT password](#list-files-in-one-liner-without-password-1)
```sh
smbclient -N //$t/Replication
smbclient -N //$t/Replication -c ls
smbclient -N //$t/Replication -c 'rec;ls'
smbclient -N //$t/Replication -c 'recurse;ls'
```

### [List files in one-liner WITH password](#list-files-in-one-liner-with-password-1)
```sh
# Arrangement for IP, or shares doesn't matter

smbclient -Usupport%'#00^BlackKnight' -c ls //$t/profiles$
smbclient //$t/profiles$ -Usupport%'#00^BlackKnight' -c ls
smbclient -c 'recurse;prompt;mget *' -Usupport%'#00^BlackKnight' //$t/SYSVOL

$ smbclient -Usupport%'#00^BlackKnight' -c ls //$t/profiles$
  .                                   D        0  Thu Jun  4 00:47:12 2020
  ..                                  D        0  Thu Jun  4 00:47:12 2020
  AAlleni                             D        0  Thu Jun  4 00:47:11 2020
  ABarteski                           D        0  Thu Jun  4 00:47:11 2020
  ABekesz                             D        0  Thu Jun  4 00:47:11 2020
```

## Download directory
### [Download a directory recursively](#download-a-directory-recursively-1)
https://superuser.com/questions/856617/how-do-i-recursively-download-a-directory-using-smbclient
```sh
smbclient -N //$t/Replication
recurse
prompt
mget *
```

### Download a directory recursively in one-liner without password
```sh
smbclient -N //$t/Data -c 'recurse;prompt;mget *'
smbclient -N //$t/profiles$ -c 'rec;pro;mget *'
```

# Drawbacks

# [Other Tools](#other-tools-1)

# List shares, via smbclient, crackmapexec, and smbmap


- [cme](#cme-smb-ip---shares--u---p)
        [-M spider_plus](#m-spider_plus)
- [smbmap](#smbmap--h-ip)
- [$t must follow sequence as follows, else error (which tool?)](#t-must-follow-sequence-as-follows-else-error-which-tool)


### smbclient does not show READ/WRITE status, use cme for this purpose
Examples on HTB Active box, 10.10.10.100
```sh
$ smbclient -NL $t
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        NETLOGON        Disk      Logon server share 
        Replication     Disk      
        SYSVOL          Disk      Logon server share 
        Users           Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.100 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

## [CrackMapExec (cme)](#crackmapexec-cme-1)
### cme smb $t --shares -u '' -p ''
```sh
$ crackmapexec smb $t --shares -u '' -p ''
SMB         10.10.10.100    445    DC               [*] Windows 6.1 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False)
SMB         10.10.10.100    445    DC               [+] active.htb\: 
SMB         10.10.10.100    445    DC               [+] Enumerated shares
SMB         10.10.10.100    445    DC               Share           Permissions     Remark
SMB         10.10.10.100    445    DC               -----           -----------     ------
SMB         10.10.10.100    445    DC               ADMIN$                          Remote Admin
SMB         10.10.10.100    445    DC               C$                              Default share
SMB         10.10.10.100    445    DC               IPC$                            Remote IPC
SMB         10.10.10.100    445    DC               NETLOGON                        Logon server share 
SMB         10.10.10.100    445    DC               Replication     READ            
SMB         10.10.10.100    445    DC               SYSVOL                          Logon server share 
SMB         10.10.10.100    445    DC               Users
```

### [-M spider_plus](#m-spider_plus-1)
HTB Cascade
```sh
$ cme smb $t -u r.thompson -p rY4n5eva --shares -M spider_plus
SMB         10.10.10.182    445    CASC-DC1         [*] Windows 6.1 Build 7601 x64 (name:CASC-DC1) (domain:cascade.local) (signing:True) (SMBv1:False)
SMB         10.10.10.182    445    CASC-DC1         [+] cascade.local\r.thompson:rY4n5eva 
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] Started module spidering_plus with the following options:
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]  DOWNLOAD_FLAG: False
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]     STATS_FLAG: True
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] EXCLUDE_FILTER: ['print$', 'ipc$']
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]   EXCLUDE_EXTS: ['ico', 'lnk']
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]  MAX_FILE_SIZE: 50 KB
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*]  OUTPUT_FOLDER: /tmp/cme_spider_plus
SPIDER_P... 10.10.10.182    445    CASC-DC1         [+] Saved share-file metadata to "/tmp/cme_spider_plus/10.10.10.182.json".
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] SMB Shares:           8 (ADMIN$, Audit$, C$, Data, IPC$, NETLOGON, print$, SYSVOL)
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] SMB Readable Shares:  4 (Data, NETLOGON, print$, SYSVOL)
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] SMB Filtered Shares:  1
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] Total folders found:  58
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] Total files found:    20
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] File size average:    1.07 KB
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] File size min:        6 B
SPIDER_P... 10.10.10.182    445    CASC-DC1         [*] File size max:        5.83 KB
```

# [smbmap](#smbmap-1)

## [smbmap -H $t](#smbmap--h-t-1)
```sh
$ smbmap -H $t
[+] IP: 10.10.10.100:445        Name: active.htb                                        
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    NO ACCESS       Remote IPC
        NETLOGON                                                NO ACCESS       Logon server share 
        Replication                                             READ ONLY
        SYSVOL                                                  NO ACCESS       Logon server share 
        Users                                                   NO ACCESS
```

#### $t must follow sequence as follows, else error (which tool?)
```sh
smbmap -H $t
smbclient -N //$t/shares -c ls
```